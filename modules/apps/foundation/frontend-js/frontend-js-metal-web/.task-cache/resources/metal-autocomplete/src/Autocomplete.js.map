{"version":3,"sources":["/source/Autocomplete.js"],"names":[],"mappings":"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","sourcesContent":["'use strict';\n\nimport core from 'metal';\nimport debounce from 'metal-debounce';\nimport dom from 'metal-dom';\nimport { CancellablePromise as Promise } from 'metal-promise';\nimport { Align } from 'metal-position';\nimport AutocompleteBase from './AutocompleteBase';\nimport Soy from 'metal-soy';\n\nimport 'metal-list';\nimport templates from './Autocomplete.soy';\n\n/*\n * Autocomplete component.\n */\nclass Autocomplete extends AutocompleteBase {\n\t/**\n\t * @inheritDoc\n\t */\n\tattached() {\n\t\tsuper.attached();\n\t\tthis.on('click', event => event.stopPropagation());\n\t\tthis.eventHandler_.add(dom.on(this.inputElement, 'focus', this.handleInputFocus_.bind(this)));\n\t\tthis.eventHandler_.add(dom.on(document, 'click', this.handleDocClick_.bind(this)));\n\t\tthis.eventHandler_.add(dom.on(window, 'resize', debounce(this.handleWindowResize_.bind(this), 100)));\n\t\tif (this.visible) {\n\t\t\tthis.align();\n\t\t}\n\t}\n\n\t/**\n\t * Aligns main element to the input element.\n\t */\n\talign() {\n\t\tthis.element.style.width = this.inputElement.offsetWidth + 'px';\n\t\tvar position = Align.align(this.element, this.inputElement, Align.Bottom);\n\n\t\tdom.removeClasses(this.element, this.positionCss_);\n\t\tswitch (position) {\n\t\t\tcase Align.Top:\n\t\t\tcase Align.TopLeft:\n\t\t\tcase Align.TopRight:\n\t\t\t\tthis.positionCss_ = 'autocomplete-top';\n\t\t\t\tbreak;\n\t\t\tcase Align.Bottom:\n\t\t\tcase Align.BottomLeft:\n\t\t\tcase Align.BottomRight:\n\t\t\t\tthis.positionCss_ = 'autocomplete-bottom';\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.positionCss_ = null;\n\n\t\t}\n\t\tdom.addClasses(this.element, this.positionCss_);\n\t}\n\n\t/**\n\t * Returns the `List` component being used to render the matched items.\n\t * @return {!List}\n\t */\n\tgetList() {\n\t\treturn this.components.list;\n\t}\n\n\t/**\n\t * Handles document click in order to hide autocomplete. If input element is\n\t * focused autocomplete will not hide.\n\t * @param {!Event} event\n\t */\n\thandleDocClick_() {\n\t\tif (document.activeElement === this.inputElement) {\n\t\t\treturn;\n\t\t}\n\t\tthis.visible = false;\n\t}\n\n\t/**\n\t * Handles input focus.\n\t * @param {!Event} event\n\t */\n\thandleInputFocus_() {\n\t\tthis.request(this.inputElement.value);\n\t}\n\n\t/**\n\t * Handles window resize events. Realigns the autocomplete results list to\n\t * the input field.\n\t */\n\thandleWindowResize_() {\n\t\tif (this.visible) {\n\t\t\tthis.align();\n\t\t}\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\trequest(query) {\n\t\tvar self = this;\n\t\treturn super.request(query).then(function(data) {\n\t\t\tif (data) {\n\t\t\t\tdata.forEach(self.assertItemObjectStructure_);\n\t\t\t\tself.getList().items = data;\n\t\t\t}\n\t\t\tself.visible = !!(data && data.length > 0);\n\t\t});\n\t}\n\n\t/**\n\t * Emits a `select` event with the information about the selected item and\n\t * hides the element.\n\t * @param {!Element} item The list selected item.\n\t * @protected\n\t */\n\tonListItemSelected_(item) {\n\t\tvar selectedIndex = parseInt(item.getAttribute('data-index'), 10);\n\t\tthis.emit('select', this.getList().items[selectedIndex]);\n\t\tthis.visible = false;\n\t}\n\n\t/**\n\t * Synchronization logic for `visible` state.\n\t * @param {boolean} visible\n\t */\n\tsyncVisible(visible) {\n\t\tsuper.syncVisible(visible);\n\n\t\tif (visible) {\n\t\t\tthis.align();\n\t\t}\n\t}\n\n\t/**\n\t * Asserts that formatted data is valid. Throws error if item is not in the\n\t * valid syntax.\n\t * @param {*} item\n\t * @protected\n\t */\n\tassertItemObjectStructure_(item) {\n\t\tif (!core.isObject(item)) {\n\t\t\tthrow new Promise.CancellationError('Autocomplete item must be an object');\n\t\t}\n\t\tif (!item.hasOwnProperty('textPrimary')) {\n\t\t\tthrow new Promise.CancellationError('Autocomplete item must be an object with \\'textPrimary\\' key');\n\t\t}\n\t}\n}\nSoy.register(Autocomplete, templates);\n\n/**\n * State definition.\n * @type {!Object}\n * @static\n */\nAutocomplete.STATE = {\n\t/**\n\t * Function that converts a given item to the format that should be used by\n\t * the autocomplete.\n\t * @type {!function()}\n\t */\n\tformat: {\n\t\tvalue: function(item) {\n\t\t\tif (core.isString(item)) {\n\t\t\t\titem = {\n\t\t\t\t\ttextPrimary: item\n\t\t\t\t};\n\t\t\t}\n\t\t\tif (core.isObject(item) && !item.text) {\n\t\t\t\titem.text = item.textPrimary;\n\t\t\t}\n\t\t\treturn item;\n\t\t}\n\t}\n};\n\nexport default Autocomplete;\nimport JQueryAdapter from 'metal-jquery-adapter/src/JQueryAdapter';JQueryAdapter.register('autocomplete', Autocomplete);"]}
{"version":3,"sources":["/source/EventScreen.es.js"],"names":[],"mappings":"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","sourcesContent":["'use strict';\n\nimport HtmlScreen from 'senna/src/screen/HtmlScreen';\nimport globals from 'senna/src/globals/globals';\nimport {CancellablePromise} from 'metal-promise/src/promise/Promise';\nimport Utils from '../util/Utils.es';\n\nclass EventScreen extends HtmlScreen {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.cacheable = false;\n\t\tthis.timeout = Math.max(Liferay.SPA.requestTimeout, 0) || Utils.getMaxTimeout();\n\t}\n\n\tdispose() {\n\t\tsuper.dispose();\n\n\t\tLiferay.fire(\n\t\t\t'screenDispose',\n\t\t\t{\n\t\t\t\tapp: Liferay.SPA.app,\n\t\t\t\tscreen: this\n\t\t\t}\n\t\t);\n\t}\n\n\tactivate() {\n\t\tsuper.activate();\n\n\t\tLiferay.fire(\n\t\t\t'screenActivate',\n\t\t\t{\n\t\t\t\tapp: Liferay.SPA.app,\n\t\t\t\tscreen: this\n\t\t\t}\n\t\t);\n\t}\n\n\t_clearRequestTimer() {\n\t\tif (this.requestTimer) {\n\t\t\tclearTimeout(this.requestTimer);\n\t\t}\n\n\t\tif (this.timeoutAlert) {\n\t\t\tthis.timeoutAlert.hide();\n\t\t}\n\t}\n\n\t_createTimeoutNotification() {\n\t\tvar instance = this;\n\n\t\tAUI().use(\n\t\t\t'liferay-notification',\n\t\t\t() => {\n\t\t\t\tinstance.timeoutAlert = new Liferay.Notification(\n\t\t\t\t\t{\n\t\t\t\t\t\tcloseable: true,\n\t\t\t\t\t\tdelay: {\n\t\t\t\t\t\t\thide: 0,\n\t\t\t\t\t\t\tshow: 0\n\t\t\t\t\t\t},\n\t\t\t\t\t\tduration: 500,\n\t\t\t\t\t\tmessage: Liferay.SPA.userNotification.message,\n\t\t\t\t\t\ttitle: Liferay.SPA.userNotification.title,\n\t\t\t\t\t\ttype: 'warning'\n\t\t\t\t\t}\n\t\t\t\t).render('body');\n\t\t\t}\n\t\t);\n\t}\n\n\t_startRequestTimer(path) {\n\t\tif (Liferay.SPA.userNotification.timeout > 0) {\n\t\t\tthis._clearRequestTimer();\n\n\t\t\tthis.requestTimer = setTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tLiferay.fire(\n\t\t\t\t\t\t'spaRequestTimeout',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpath: path\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tif (!this.timeoutAlert) {\n\t\t\t\t\t\tthis._createTimeoutNotification();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.timeoutAlert.show();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tLiferay.SPA.userNotification.timeout\n\t\t\t);\n\t\t}\n\t}\n\n\taddCache(content) {\n\t\tsuper.addCache(content);\n\n\t\tthis.cacheLastModified = (new Date()).getTime();\n\t}\n\n\tcheckRedirectPath(redirectPath) {\n\t\tvar app = Liferay.SPA.app;\n\n\t\tif (!globals.capturedFormElement && !app.findRoute(redirectPath)) {\n\t\t\twindow.location.href = redirectPath;\n\t\t}\n\t}\n\n\tdeactivate() {\n\t\tsuper.deactivate();\n\n\t\tLiferay.fire(\n\t\t\t'screenDeactivate',\n\t\t\t{\n\t\t\t\tapp: Liferay.SPA.app,\n\t\t\t\tscreen: this\n\t\t\t}\n\t\t);\n\t}\n\n\tbeforeScreenFlip() {\n\t\tLiferay.fire(\n\t\t\t'beforeScreenFlip',\n\t\t\t{\n\t\t\t\tapp: Liferay.SPA.app,\n\t\t\t\tscreen: this\n\t\t\t}\n\t\t);\n\t}\n\n\tcopyBodyAttributes() {\n\t\tvar virtualBody = this.virtualDocument.querySelector('body');\n\n\t\tdocument.body.className = virtualBody.className;\n\t\tdocument.body.onload = virtualBody.onload;\n\t}\n\n\tflip(surfaces) {\n\t\tthis.copyBodyAttributes();\n\n\t\treturn CancellablePromise.resolve(Utils.resetAllPortlets())\n\t\t\t.then(CancellablePromise.resolve(this.beforeScreenFlip()))\n\t\t\t.then(super.flip(surfaces))\n\t\t\t.then(\n\t\t\t\t() => {\n\t\t\t\t\tthis.runBodyOnLoad();\n\n\t\t\t\t\tLiferay.fire(\n\t\t\t\t\t\t'screenFlip',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tapp: Liferay.SPA.app,\n\t\t\t\t\t\t\tscreen: this\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\t}\n\n\tgetCache() {\n\t\tvar app = Liferay.SPA.app;\n\n\t\tif (app.isCacheEnabled() && !app.isScreenCacheExpired(this)) {\n\t\t\treturn super.getCache();\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetCacheLastModified() {\n\t\treturn this.cacheLastModified;\n\t}\n\n\tisValidResponseStatusCode(statusCode) {\n\t\tvar validStatusCodes = Liferay.SPA.app.getValidStatusCodes();\n\n\t\treturn super.isValidResponseStatusCode(statusCode) || (validStatusCodes.indexOf(statusCode) > -1);\n\t}\n\n\tload(path) {\n\t\tthis._startRequestTimer(path);\n\n\t\treturn super.load(path)\n\t\t\t.then(\n\t\t\t\t(content) => {\n\t\t\t\t\tthis._clearRequestTimer();\n\n\t\t\t\t\tvar redirectPath = this.beforeUpdateHistoryPath(path);\n\n\t\t\t\t\tthis.checkRedirectPath(redirectPath);\n\n\t\t\t\t\tLiferay.fire(\n\t\t\t\t\t\t'screenLoad',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tapp: Liferay.SPA.app,\n\t\t\t\t\t\t\tcontent: content,\n\t\t\t\t\t\t\tscreen: this\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\treturn content;\n\t\t\t\t}\n\t\t\t);\n\t}\n\n\trunBodyOnLoad() {\n\t\tvar onLoad = document.body.onload;\n\n\t\tif (onLoad) {\n\t\t\tonLoad();\n\t\t}\n\t}\n}\n\nexport default EventScreen;"]}
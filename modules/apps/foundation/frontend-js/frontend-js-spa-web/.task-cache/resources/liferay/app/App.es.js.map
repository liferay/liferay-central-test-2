{"version":3,"sources":["/source/App.es.js"],"names":[],"mappings":"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","sourcesContent":["'use strict';\n\nimport App from 'senna/src/app/App';\nimport core from 'metal/src/core';\nimport dom from 'metal-dom/src/dom';\nimport Utils from '../util/Utils.es';\nimport LiferaySurface from '../surface/Surface.es';\n\nclass LiferayApp extends App {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.portletsBlacklist = {};\n\t\tthis.validStatusCodes = [];\n\n\t\tthis.timeout = Math.max(Liferay.SPA.requestTimeout, 0) || Utils.getMaxTimeout();\n\t\tthis.timeoutAlert = null;\n\n\t\tvar exceptionsSelector = ':not([target=\"_blank\"]):not([data-senna-off]):not([data-resource-href])';\n\n\t\tthis.setFormSelector('form' + exceptionsSelector);\n\t\tthis.setLinkSelector('a' + exceptionsSelector);\n\t\tthis.setLoadingCssClass('lfr-spa-loading');\n\n\t\tthis.on('beforeNavigate', this.onBeforeNavigate);\n\t\tthis.on('endNavigate', this.onEndNavigate);\n\t\tthis.on('startNavigate', this.onStartNavigate);\n\n\t\tLiferay.on('io:complete', this.onLiferayIOComplete, this);\n\n\t\tvar body = document.body;\n\n\t\tif (!body.id) {\n\t\t\tbody.id = 'senna_surface' + core.getUid();\n\t\t}\n\n\t\tthis.addSurfaces(new LiferaySurface(body.id));\n\n\t\tdom.append(body, '<div class=\"lfr-spa-loading-bar\"></div>');\n\t}\n\n\tgetCacheExpirationTime() {\n\t\treturn Liferay.SPA.cacheExpirationTime;\n\t}\n\n\tgetValidStatusCodes() {\n\t\treturn this.validStatusCodes;\n\t}\n\n\tisCacheEnabled() {\n\t\treturn this.getCacheExpirationTime() > -1;\n\t}\n\n\tisInPortletBlacklist(element) {\n\t\treturn Object.keys(this.portletsBlacklist).some(\n\t\t\t(portletId) => {\n\t\t\t\tvar boundaryId = Utils.getPortletBoundaryId(portletId);\n\n\t\t\t\tvar portlets = document.querySelectorAll('[id^=\"' + boundaryId + '\"]');\n\n\t\t\t\treturn Array.prototype.slice.call(portlets).some(portlet => dom.contains(portlet, element));\n\t\t\t}\n\t\t);\n\t}\n\n\tisScreenCacheExpired(screen) {\n\t\tif (this.getCacheExpirationTime() === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar lastModifiedInterval = (new Date()).getTime() - screen.getCacheLastModified();\n\n\t\treturn lastModifiedInterval > this.getCacheExpirationTime();\n\t}\n\n\tonBeforeNavigate(event) {\n\t\tif (Liferay.SPA.clearScreensCache || event.form) {\n\t\t\tthis.clearScreensCache();\n\t\t}\n\n\t\tLiferay.fire(\n\t\t\t'beforeNavigate',\n\t\t\t{\n\t\t\t\tapp: this,\n\t\t\t\tpath: event.path\n\t\t\t}\n\t\t);\n\t}\n\n\tonDocClickDelegate_(event) {\n\t\tif (this.isInPortletBlacklist(event.delegateTarget)) {\n\t\t\treturn;\n\t\t}\n\n\t\tsuper.onDocClickDelegate_(event);\n\t}\n\n\tonDocSubmitDelegate_(event) {\n\t\tif (this.isInPortletBlacklist(event.delegateTarget)) {\n\t\t\treturn;\n\t\t}\n\n\t\tsuper.onDocSubmitDelegate_(event);\n\t}\n\n\tonEndNavigate(event) {\n\t\tLiferay.fire(\n\t\t\t'endNavigate',\n\t\t\t{\n\t\t\t\tapp: this,\n\t\t\t\terror: event.error,\n\t\t\t\tpath: event.path\n\t\t\t}\n\t\t);\n\n\t\tif (!this.pendingNavigate) {\n\t\t\tthis._clearRequestTimer();\n\t\t\tthis._hideTimeoutAlert();\n\t\t}\n\n\t\tif (event.error) {\n\t\t\tif (event.error.invalidStatus || event.error.requestError || event.error.timeout) {\n\t\t\t\tif (event.form) {\n\t\t\t\t\tevent.form.submit();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\twindow.location.href = event.path;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (Liferay.Layout && Liferay.Data.layoutConfig) {\n\t\t\tLiferay.Layout.init();\n\t\t}\n\n\t\tAUI().Get._insertCache = {};\n\n\t\tLiferay.DOMTaskRunner.reset();\n\t}\n\n\tonLiferayIOComplete() {\n\t\tthis.clearScreensCache();\n\t}\n\n\tonStartNavigate(event) {\n\t\tLiferay.fire(\n\t\t\t'startNavigate',\n\t\t\t{\n\t\t\t\tapp: this,\n\t\t\t\tpath: event.path\n\t\t\t}\n\t\t);\n\n\t\tthis._startRequestTimer(event.path);\n\t}\n\n\tsetPortletsBlacklist(portletsBlacklist) {\n\t\tthis.portletsBlacklist = portletsBlacklist;\n\t}\n\n\tsetValidStatusCodes(validStatusCodes) {\n\t\tthis.validStatusCodes = validStatusCodes;\n\t}\n\n\t_clearRequestTimer() {\n\t\tif (this.requestTimer) {\n\t\t\tclearTimeout(this.requestTimer);\n\t\t}\n\t}\n\n\t_createTimeoutNotification() {\n\t\tvar instance = this;\n\n\t\tAUI().use(\n\t\t\t'liferay-notification',\n\t\t\t() => {\n\t\t\t\tinstance.timeoutAlert = new Liferay.Notification(\n\t\t\t\t\t{\n\t\t\t\t\t\tcloseable: true,\n\t\t\t\t\t\tdelay: {\n\t\t\t\t\t\t\thide: 0,\n\t\t\t\t\t\t\tshow: 0\n\t\t\t\t\t\t},\n\t\t\t\t\t\tduration: 500,\n\t\t\t\t\t\tmessage: Liferay.SPA.userNotification.message,\n\t\t\t\t\t\ttitle: Liferay.SPA.userNotification.title,\n\t\t\t\t\t\ttype: 'warning'\n\t\t\t\t\t}\n\t\t\t\t).render('body');\n\t\t\t}\n\t\t);\n\t}\n\n\t_hideTimeoutAlert() {\n\t\tif (this.timeoutAlert) {\n\t\t\tthis.timeoutAlert.hide();\n\t\t}\n\t}\n\n\t_startRequestTimer(path) {\n\t\tthis._clearRequestTimer();\n\n\t\tif (Liferay.SPA.userNotification.timeout > 0) {\n\t\t\tthis.requestTimer = setTimeout(\n\t\t\t\t() => {\n\t\t\t\t\tLiferay.fire(\n\t\t\t\t\t\t'spaRequestTimeout',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpath: path\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\t\tif (!this.timeoutAlert) {\n\t\t\t\t\t\tthis._createTimeoutNotification();\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tthis.timeoutAlert.show();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tLiferay.SPA.userNotification.timeout\n\t\t\t);\n\t\t}\n\t}\n}\n\nexport default LiferayApp;"]}
{"version":3,"sources":["/source/Scrollspy.js"],"names":[],"mappings":"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","sourcesContent":["'use strict';\n\nimport core from 'metal';\nimport dom from 'metal-dom';\nimport Attribute from 'metal-attribute';\nimport Position from 'metal-position';\n\n/**\n * Scrollspy utility.\n */\nclass Scrollspy extends Attribute {\n\t/**\n\t * @inheritDoc\n\t */\n\tconstructor(opt_config) {\n\t\tsuper(opt_config);\n\n\t\t/**\n\t\t * Holds the regions cache.\n\t\t * @type {!Array}\n\t\t * @private\n\t\t * @default []\n\t\t */\n\t\tthis.regions = [];\n\n\t\t/**\n\t\t * Holds event handle that listens scroll shared event emitter proxy.\n\t\t * @type {!EventHandle}\n\t\t * @protected\n\t\t */\n\t\tthis.scrollHandle_ = dom.on(this.scrollElement, 'scroll', this.checkPosition.bind(this));\n\n\t\tthis.init();\n\t}\n\n\t/**\n\t * @inheritDoc\n\t */\n\tdisposeInternal() {\n\t\tthis.deactivateAll();\n\t\tthis.scrollHandle_.dispose();\n\t\tsuper.disposeInternal();\n\t}\n\n\t/**\n\t * Activates index matching element.\n\t * @param {number} index\n\t */\n\tactivate(index) {\n\t\tif (this.activeIndex >= 0) {\n\t\t\tthis.deactivate(this.activeIndex);\n\t\t}\n\t\tthis.activeIndex = index;\n\t\tdom.addClasses(this.getElementForIndex(index), this.activeClass);\n\t}\n\n\t/**\n\t * Checks position of elements and activate the one in region.\n\t */\n\tcheckPosition() {\n\t\tvar scrollHeight = this.getScrollHeight_();\n\t\tvar scrollTop = Position.getScrollTop(this.scrollElement);\n\n\t\tif (scrollHeight < scrollTop + this.offset) {\n\t\t\tthis.activate(this.regions.length - 1);\n\t\t\treturn;\n\t\t}\n\n\t\tvar index = this.findBestRegionAt_();\n\t\tif (index !== this.activeIndex) {\n\t\t\tif (index === -1) {\n\t\t\t\tthis.deactivateAll();\n\t\t\t} else {\n\t\t\t\tthis.activate(index);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Deactivates index matching element.\n\t * @param {number} index\n\t */\n\tdeactivate(index) {\n\t\tdom.removeClasses(this.getElementForIndex(index), this.activeClass);\n\t}\n\n\t/**\n\t * Deactivates all elements.\n\t */\n\tdeactivateAll() {\n\t\tfor (var i = 0; i < this.regions.length; i++) {\n\t\t\tthis.deactivate(i);\n\t\t}\n\t\tthis.activeIndex = -1;\n\t}\n\n\t/**\n\t * Finds best region to activate.\n\t * @return {number} The index of best region found.\n\t */\n\tfindBestRegionAt_() {\n\t\tvar index = -1;\n\t\tvar origin = this.getCurrentPosition();\n\t\tif (this.regions.length > 0 && origin >= this.regions[0].top) {\n\t\t\tfor (var i = 0; i < this.regions.length; i++) {\n\t\t\t\tvar region = this.regions[i];\n\t\t\t\tvar lastRegion = i === this.regions.length - 1;\n\t\t\t\tif ((origin >= region.top) && (lastRegion || (origin < this.regions[i + 1].top))) {\n\t\t\t\t\tindex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn index;\n\t}\n\n\t/**\n\t * Gets the current position in the page.\n\t * @return {number}\n\t */\n\tgetCurrentPosition() {\n\t\tvar scrollTop = Position.getScrollTop(this.scrollElement);\n\t\treturn scrollTop + this.offset + this.scrollElementRegion_.top;\n\t}\n\n\t/**\n\t * Returns the element that should be used for the link at the given index.\n\t * @param {number} index\n\t * @return {!Element}\n\t */\n\tgetElementForIndex(index) {\n\t\treturn this.resolveElement(this.regions[index].link);\n\t}\n\n\t/**\n\t * Gets the scroll height of `scrollElement`.\n\t * @return {number}\n\t * @protected\n\t */\n\tgetScrollHeight_() {\n\t\tvar scrollHeight = Position.getHeight(this.scrollElement);\n\t\tscrollHeight += this.scrollElementRegion_.top;\n\t\tscrollHeight -= Position.getClientHeight(this.scrollElement);\n\t\treturn scrollHeight;\n\t}\n\n\t/**\n\t * Initializes the behavior of scrollspy. It's important to have this as a\n\t * separate function so subclasses can override it (babel doesn't allow using\n\t * `this` on constructors before calling `super()`).\n\t */\n\tinit() {\n\t\tthis.refresh();\n\t\tthis.on('elementChanged', this.refresh);\n\t\tthis.on('offsetChanged', this.checkPosition);\n\t\tthis.on('scrollElementChanged', this.onScrollElementChanged_);\n\t\tthis.on('selectorChanged', this.refresh);\n\t}\n\n\t/**\n\t * Fired when the value of the `scrollElement` attribute changes.\n\t * Refreshes the spy and updates the event handler to listen to the new scroll element.\n\t * @param {!Event} event\n\t * @protected\n\t */\n\tonScrollElementChanged_(event) {\n\t\tthis.refresh();\n\n\t\tthis.scrollHandle_.dispose();\n\t\tthis.scrollHandle_ = dom.on(event.newVal, 'scroll', this.checkPosition.bind(this));\n\t}\n\n\t/**\n\t * Refreshes all regions from document. Relevant when spying elements that\n\t * nodes can be added and removed.\n\t */\n\trefresh() {\n\t\t// Removes the \"active\" class from all current regions.\n\t\tthis.deactivateAll();\n\n\t\tthis.scrollElementRegion_ = Position.getRegion(this.scrollElement);\n\t\tthis.scrollHeight_ = this.getScrollHeight_();\n\n\t\tthis.regions = [];\n\t\tvar links = this.element.querySelectorAll(this.selector);\n\t\tvar scrollTop = Position.getScrollTop(this.scrollElement);\n\t\tfor (var i = 0; i < links.length; ++i) {\n\t\t\tvar link = links[i];\n\t\t\tif (link.hash && (link.hash.length > 1)) {\n\t\t\t\tvar element = document.getElementById(link.hash.substring(1));\n\t\t\t\tif (element) {\n\t\t\t\t\tvar region = Position.getRegion(element);\n\t\t\t\t\tthis.regions.push({\n\t\t\t\t\t\tlink: link,\n\t\t\t\t\t\ttop: region.top + scrollTop,\n\t\t\t\t\t\tbottom: region.bottom + scrollTop\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.sortRegions_();\n\n\t\t// Removes the \"active\" class from all new regions and then activate the right one for\n\t\t// the current position.\n\t\tthis.deactivateAll();\n\t\tthis.checkPosition();\n\t}\n\n\t/**\n\t * Sorts regions from lower to higher on y-axis.\n\t * @protected\n\t */\n\tsortRegions_() {\n\t\tthis.regions.sort(function(a, b) {\n\t\t\treturn a.top - b.top;\n\t\t});\n\t}\n}\n\nScrollspy.ATTRS = {\n\t/**\n\t * Class to be used as active class.\n\t * @attribute activeClass\n\t * @type {string}\n\t */\n\tactiveClass: {\n\t\tvalidator: core.isString,\n\t\tvalue: 'active'\n\t},\n\n\t/**\n\t * The index of the currently active link.\n\t * @type {number}\n\t */\n\tactiveIndex: {\n\t\tvalidator: core.isNumber,\n\t\tvalue: -1\n\t},\n\n\t/**\n\t * Function that receives the matching element as argument and return\n\t * itself. Relevant when the `activeClass` must be applied to a different\n\t * element, e.g. a parentNode.\n\t * @type {function}\n\t * @default core.identityFunction\n\t */\n\tresolveElement: {\n\t\tvalidator: core.isFunction,\n\t\tvalue: core.identityFunction\n\t},\n\n\t/**\n\t * The scrollElement element to be used as scrollElement area for scrollspy.\n\t * The scrollElement is where the scroll event is listened from.\n\t * @type {Element|Window}\n\t */\n\tscrollElement: {\n\t\tsetter: dom.toElement,\n\t\tvalue: document\n\t},\n\n\t/**\n\t * Defines the offset that triggers scrollspy.\n\t * @type {number}\n\t * @default 0\n\t */\n\toffset: {\n\t\tvalidator: core.isNumber,\n\t\tvalue: 0\n\t},\n\n\t/**\n\t * Element to be used as alignment reference of scrollspy.\n\t * @type {Element}\n\t */\n\telement: {\n\t\tsetter: dom.toElement\n\t},\n\n\t/**\n\t * Selector to query elements inside `element` to be activated.\n\t * @type {Element}\n\t * @default 'a'\n\t */\n\tselector: {\n\t\tvalidator: core.isString,\n\t\tvalue: 'a'\n\t}\n};\n\nexport default Scrollspy;\nimport JQueryAdapter from 'metal-jquery-adapter/src/JQueryAdapter';JQueryAdapter.register('scrollspy', Scrollspy);"]}
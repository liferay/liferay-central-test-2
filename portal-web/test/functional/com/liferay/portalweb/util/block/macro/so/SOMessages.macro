<definition>
	<var name="password" value="test" />

	<command name="sendMessage">
		<execute function="#assertClick" locator1="SOMessages#NEW_MESSAGE_BUTTON" value1="New Message" />

		<execute function="#selectFrame" locator1="SOMessagesAdd#NEW_MESSAGE_IFRAME" />

		<if>
			<isset var="recipientNameList" />
			<then>
				<for list="${recipientNameList}" param="recipientName">
					<var name="key_recipientName" value="${recipientName}" />

					<execute function="Type#sendKeys" locator1="SOMessagesAdd#TO_FIELD" value1="${recipientName}" />
					<execute function="AssertClick#pauseAssertPartialTextClickAt" locator1="SOMessagesAdd#TO_FIELD_DROPDOWN_LIST" value1="${recipientName}" />
				</for>
			</then>
			<else>
				<var name="key_recipientName" value="${recipientName}" />

				<execute function="Type#sendKeys" locator1="SOMessagesAdd#TO_FIELD" value1="${recipientName}" />
				<execute function="AssertClick#pauseAssertPartialTextClickAt" locator1="SOMessagesAdd#TO_FIELD_DROPDOWN_LIST" value1="${recipientName}" />
				<execute function="#assertTextEquals" locator1="SOMessagesAdd#TO_FIELD" value1="${recipientName} &lt;${recipientScreenName}&gt;, " />
			</else>
		</if>

		<execute function="#type" locator1="SOMessagesAdd#SUBJECT_FIELD" value1="${messageSubject}" />
		<execute function="#type" locator1="SOMessagesAdd#BODY_FIELD" value1="${messageBody}" />

		<if>
			<isset var="messageAttachmentFile" />
			<then>
				<execute function="#uploadCommonFile" locator1="SOMessagesAdd#ATTACHMENTS_FIELD" value1="${messageAttachmentFile}" />
			</then>
		</if>

		<execute function="#click" locator1="SOMessagesAdd#SEND_BUTTON" />
		<execute function="#pause" locator1="1000" />

		<execute function="#selectFrame" value1="relative=top" />

		<if>
			<isset var="partialMessageBody" />
			<then>
				<var name="key_messageBody" value="${partialMessageBody}" />
			</then>
			<else>
				<var name="key_messageBody" value="${messageBody}" />
			</else>
		</if>

		<execute function="#assertElementPresent" locator1="SOMessages#MESSAGE_SENDER" />
		<execute function="#assertElementPresent" locator1="SOMessages#MESSAGE_SUBJECT" />
		<execute function="#assertElementPresent" locator1="SOMessages#MESSAGE_BODY" />
	</command>

	<command name="sendReplyMessage">
		<execute function="#type" locator1="SOMessagesMessage#PRIVATE_MESSAGE_REPLY_BODY_FIELD" value1="${messageReplyBody}" />

		<if>
			<isset var="messageReplyAttachmentFile" />
			<then>
				<execute function="#uploadCommonFile" locator1="SOMessagesMessage#PRIVATE_MESSAGE_REPLY_ATTACHMENT_FIELD" value1="${messageReplyAttachmentFile}" />
			</then>
		</if>

		<execute function="#click" locator1="SOMessagesMessage#PRIVATE_MESSAGE_SEND_BUTTON" />

		<var name="key_messageReplyBody" value="${messageReplyBody}" />

		<if>
			<isset var="pageNumber" />
			<then>
				<var name="key_pageNumber" value="${pageNumber}" />

				<execute function="#click" locator1="SOMessagesMessage#PAGE_NUMBER_DROPDOWN_BUTTON" />
				<execute function="#click" locator1="SOMessagesMessage#PAGE_NUMBER_DROPDOWN_MENU_ITEM" />
			</then>
		</if>

		<execute function="#assertElementPresent" locator1="SOMessagesMessage#PRIVATE_MESSAGE_REPLY_SENDER" />
		<execute function="#assertElementPresent" locator1="SOMessagesMessage#PRIVATE_MESSAGE_REPLY_BODY" />
	</command>

	<command name="tearDownPG">
		<execute macro="SOUser#firstLoginPG" />

		<execute macro="SOUserBar#gotoDashboardPG" />

		<execute function="#click" locator1="SODashboard#NAVIGATION_MESSAGES" />

		<if>
			<condition function="#isElementNotPresent" locator1="SOMessages#INFO_MESSAGE" />
			<then>
				<execute function="#check" locator1="SOMessages#SELECT_ALL_CHECKBOX" />
				<execute function="#clickNoError" locator1="SOMessages#DELETE_BUTTON" />
				<execute function="#confirm" locator1="SOMessages#CONFIRMATION" value1="Are you sure you want to delete the selected messages?" />
				<execute function="#assertTextEquals" locator1="SOMessages#INFO_MESSAGE" value1="No messages found." />
			</then>
		</if>
	</command>

	<command name="viewAutocompleteMenuNull">
		<execute function="#assertClick" locator1="SOMessages#NEW_MESSAGE_BUTTON" value1="New Message" />

		<execute function="#selectFrame" locator1="SOMessagesAdd#NEW_MESSAGE_IFRAME" />

		<if>
			<isset var="recipientNameList" />
			<then>
				<for list="${recipientNameList}" param="recipientName">
					<var name="key_recipientName" value="${recipientName}" />

					<execute function="Type#sendKeys" locator1="SOMessagesAdd#TO_FIELD" value1="${recipientName}" />
					<execute function="#assertElementNotPresent" locator1="SOMessagesAdd#TO_FIELD_DROPDOWN_LIST" />
				</for>
			</then>
			<elseif>
				<isset var="userInformation" />
				<then>
					<var name="key_recipientName" value="${recipientName}" />

					<execute function="Type#sendKeys" locator1="SOMessagesAdd#TO_FIELD" value1="${userInformation}" />
					<execute function="#assertElementNotPresent" locator1="SOMessagesAdd#TO_FIELD_DROPDOWN_LIST" />
				</then>
			</elseif>
			<else>
				<var name="key_recipientName" value="${recipientName}" />

				<execute function="Type#sendKeys" locator1="SOMessagesAdd#TO_FIELD" value1="${recipientName}" />
				<execute function="#assertElementNotPresent" locator1="SOMessagesAdd#TO_FIELD_DROPDOWN_LIST" />
			</else>
		</if>
	</command>

	<command name="viewMessage">
		<execute macro="SOMessages#viewMessageList" />

		<if>
			<isset var="partialMessageBody" />
			<then>
				<var name="key_messageBody" value="${partialMessageBody}" />
			</then>
			<else>
				<var name="key_messageBody" value="${messageBody}" />
			</else>
		</if>

		<execute function="#click" locator1="SOMessages#MESSAGE_SUBJECT" />

		<execute function="#assertTextEquals" locator1="SOMessagesMessage#PRIVATE_MESSAGE_SUBJECT" value1="${messageSubject}" />

		<execute macro="SOMessages#viewMessageConnectionDetailsView" />

		<execute function="#assertTextEquals" locator1="SOMessagesMessage#PRIVATE_MESSAGE_SENDER" value1="${senderName}" />
		<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_BODY" value1="${messageBody}" />

		<if>
			<isset var="messageAttachmentFile" />
			<then>
				<execute function="#assertElementPresent" locator1="SOMessagesMessage#PRIVATE_MESSAGE_ATTACHMENT" />
				<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_ATTACHMENT_LINK" value1="${messageAttachmentFile}" />
			</then>
		</if>
	</command>

	<command name="viewMessageConnectionDetailsView">
		<if>
			<isset var="connectionNameList" />
			<then>
				<var name="connectionNumber" value="0" />

				<for list="${connectionNameList}" param="connectionName">
					<var name="connectionNumber" value="${connectionNumber?increment()}" />

					<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_USERS" value1="${connectionName}" />
				</for>

				<var name="connectionNumberLast" value="${connectionNumber}" />

				<var name="connectionNumber" value="0" />

				<for list="${connectionNameList}" param="connectionName">
					<var name="connectionNumber" value="${connectionNumber?increment()}" />

					<if>
						<equals arg1="${connectionNumber}" arg2="1" />
						<then>
							<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_USERS" value1="Between ${connectionName} ," />
						</then>
						<elseif>
							<equals arg1="${connectionNumber}" arg2="${connectionNumberLast}" />
							<then>
								<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_USERS" value1=", ${connectionName} and You" />
							</then>
						</elseif>
						<else>
							<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_USERS" value1=", ${connectionName} ," />
						</else>
					</if>
				</for>
			</then>
			<else>
				<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_USERS" value1="Between ${connectionName} and You" />
			</else>
		</if>
	</command>

	<command name="viewMessageConnectionListView">
		<if>
			<isset var="connectionNameList" />
			<then>
				<var name="connectionNumber" value="0" />

				<for list="${connectionNameList}" param="connectionName">
					<var name="connectionNumber" value="${connectionNumber?increment()}" />

					<execute function="AssertTextEquals#assertPartialText" locator1="SOMessages#MESSAGE" value1="${connectionName}" />
				</for>

				<var name="connectionNumberLast" value="${connectionNumber}" />

				<var name="connectionNumber" value="0" />

				<for list="${connectionNameList}" param="connectionName">
					<var name="connectionNumber" value="${connectionNumber?increment()}" />

					<if>
						<not>
							<equals arg1="${connectionNumber}" arg2="${connectionNumberLast}" />
						</not>
						<then>
							<execute function="AssertTextEquals#assertPartialText" locator1="SOMessages#MESSAGE" value1="${connectionName} ," />
						</then>
					</if>
				</for>
			</then>
			<else>
				<execute function="#assertTextEquals" locator1="SOMessages#MESSAGE_SENDER" value1="${connectionName}" />
			</else>
		</if>
	</command>

	<command name="viewMessageList">
		<if>
			<isset var="partialMessageBody" />
			<then>
				<var name="key_messageBody" value="${partialMessageBody}" />
			</then>
			<else>
				<var name="key_messageBody" value="${messageBody}" />
			</else>
		</if>

		<execute macro="SOMessages#viewMessageConnectionListView" />

		<execute function="#assertTextEquals" locator1="SOMessages#MESSAGE_SUBJECT" value1="${messageSubject}" />
		<execute function="#assertTextEquals" locator1="SOMessages#MESSAGE_BODY" value1="${messageBody}" />
	</command>

	<command name="viewMessageNotification">
		<execute function="#assertElementPresent" locator1="SOUserBar#NOTIFICATION" />

		<if>
			<isset var="numberOfNotifications" />
			<then>
				<execute function="#assertTextEquals" locator1="SOUserBar#NOTIFICATION_MENU_COUNT" value1="${numberOfNotifications}" />
			</then>
			<else>
				<execute function="#assertTextEquals" locator1="SOUserBar#NOTIFICATION_MENU_COUNT" value1="1" />
			</else>
		</if>

		<execute function="#click" locator1="SOUserBar#NOTIFICATION" />
		<execute function="AssertTextEquals#assertPartialText" locator1="SOUserBar#NOTIFICATION_MENU_NOTIFICATION_ENTRY_CONTENT" value1="${senderName} sent you a message." />
		<execute function="#assertTextEquals" locator1="SOUserBar#NOTIFICATION_MENU_NOTIFICATION_ENTRY_SUBCONTENT" value1="${messageBody}" />
		<execute function="#assertClick" locator1="SOUserBar#NOTIFICATION_MENU_NOTIFICATION_ENTRY_CONTENT" value1="${senderName} sent you a message." />

		<if>
			<isset var="numberOfNotifications" />
			<then>
				<execute function="#assertTextNotEquals" locator1="SOUserBar#NOTIFICATION_MENU_COUNT" value1="${numberOfNotifications}" />
			</then>
			<else>
				<execute function="#assertTextEquals" locator1="SOUserBar#NOTIFICATION_MENU_COUNT" value1="0" />
			</else>
		</if>
	</command>

	<command name="viewReplyMessage">
		<execute macro="SOMessages#viewReplyMessageList" />

		<if>
			<isset var="messageReplyBodyListView" />
			<then>
				<var name="key_messageBody" value="${messageReplyBodyListView}" />
			</then>
			<else>
				<var name="key_messageBody" value="${messageReplyBody}" />
			</else>
		</if>

		<execute function="#click" locator1="SOMessages#MESSAGE_SUBJECT" />

		<var name="key_messageBody" value="${messageBody}" />
		<var name="key_messageReplyBody" value="${messageReplyBody}" />

		<execute function="#assertTextEquals" locator1="SOMessagesMessage#PRIVATE_MESSAGE_SUBJECT" value1="${messageSubject}" />

		<execute macro="SOMessages#viewMessageConnectionDetailsView" />

		<execute function="#assertTextEquals" locator1="SOMessagesMessage#PRIVATE_MESSAGE_SENDER" value1="${senderName}" />
		<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_BODY" value1="${messageBody}" />

		<if>
			<isset var="messageAttachmentFile" />
			<then>
				<execute function="#assertElementPresent" locator1="SOMessagesMessage#PRIVATE_MESSAGE_ATTACHMENT" />
				<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_ATTACHMENT_LINK" value1="${messageAttachmentFile}" />
			</then>
		</if>

		<if>
			<isset var="pageNumber" />
			<then>
				<var name="key_pageNumber" value="${pageNumber}" />

				<execute function="#click" locator1="SOMessagesMessage#PAGE_NUMBER_DROPDOWN_BUTTON" />
				<execute function="#click" locator1="SOMessagesMessage#PAGE_NUMBER_DROPDOWN_MENU_ITEM" />
			</then>
		</if>

		<execute function="#assertTextEquals" locator1="SOMessagesMessage#PRIVATE_MESSAGE_REPLY_SENDER" value1="${replySenderName}" />
		<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_REPLY_BODY" value1="${messageReplyBody}" />

		<if>
			<isset var="messageReplyAttachmentFile" />
			<then>
				<execute function="#assertElementPresent" locator1="SOMessagesMessage#PRIVATE_MESSAGE_REPLY_ATTACHMENT" />
				<execute function="AssertTextEquals#assertPartialText" locator1="SOMessagesMessage#PRIVATE_MESSAGE_REPLY_ATTACHMENT_LINK" value1="${messageReplyAttachmentFile}" />
			</then>
		</if>
	</command>

	<command name="viewReplyMessageList">
		<if>
			<isset var="messageReplyBodyListView" />
			<then>
				<var name="key_messageBody" value="${messageReplyBodyListView}" />
			</then>
			<else>
				<var name="key_messageBody" value="${messageReplyBody}" />
			</else>
		</if>

		<execute macro="SOMessages#viewMessageConnectionListView" />

		<execute function="#assertTextEquals" locator1="SOMessages#MESSAGE_SUBJECT" value1="${messageSubject}" />

		<if>
			<isset var="messageReplyBodyListView" />
			<then>
				<execute function="#assertTextEquals" locator1="SOMessages#MESSAGE_BODY" value1="${messageReplyBodyListView}" />
			</then>
			<else>
				<execute function="#assertTextEquals" locator1="SOMessages#MESSAGE_BODY" value1="${messageReplyBody}" />
			</else>
		</if>
	</command>
</definition>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>AddTemplateExpandoTest</title>
</head>
<body>
<table cellpadding="1" cellspacing="1" border="1">
<thead>
<tr><td rowspan="1" colspan="3">AddTemplateExpandoTest</td></tr>
</thead><tbody>
<tr>
	<td>open</td>
	<td>/web/expando-web-content-community/</td>
	<td></td>
</tr>
<tr>
	<td>clickAtAndWait</td>
	<td>link=Web Content Display Page</td>
	<td>Web Content Display Page</td>
</tr>
<tr>
	<td>clickAtAndWait</td>
	<td>link=Control Panel</td>
	<td>Control Panel</td>
</tr>
<tr>
	<td>clickAtAndWait</td>
	<td>link=Web Content</td>
	<td>Web Content</td>
</tr>
<tr>
	<td>clickAtAndWait</td>
	<td>link=Templates</td>
	<td>Templates</td>
</tr>
<tr>
	<td>clickAtAndWait</td>
	<td>//input[@value='Add Template']</td>
	<td>Add Template</td>
</tr>
<tr>
	<td>type</td>
	<td>//input[@id='_15_name_en_US']</td>
	<td>Expando Template Test</td>
</tr>
<tr>
	<td>type</td>
	<td>//textarea[@id='_15_description_en_US']</td>
	<td>This is an expando template test.</td>
</tr>
<tr>
	<td>store</td>
	<td>eval(selenium.isChecked('_15_cacheableCheckbox'))</td>
	<td>cacheableChecked</td>
</tr>
<tr>
	<td>gotoIf</td>
	<td>!${cacheableChecked}</td>
	<td>CacheableNotChecked</td>
</tr>
<tr>
	<td>clickAt</td>
	<td>//input[@id='_15_cacheableCheckbox']</td>
	<td>Cacheable Checkbox</td>
</tr>
<tr>
	<td>label</td>
	<td>CacheableNotChecked</td>
	<td></td>
</tr>
<tr>
	<td>clickAt</td>
	<td>//input[@value='Select']</td>
	<td>Select</td>
</tr>
<tr>
	<td>waitForVisible</td>
	<td>//iframe[contains(@src,'select_structure')]</td>
	<td>Structure</td>
</tr>
<tr>
	<td>selectFrame</td>
	<td>//iframe[contains(@src,'select_structure')]</td>
	<td>Structure</td>
</tr>
<tr>
	<td>waitForVisible</td>
	<td>//td[2]/a</td>
	<td>Expando Structure Test</td>
</tr>
<tr>
	<td>assertText</td>
	<td>//td[2]/a</td>
	<td>Expando Structure Test</td>
</tr>
<tr>
	<td>clickAt</td>
	<td>//td[2]/a</td>
	<td>Expando Structure Test</td>
</tr>
<tr>
	<td>selectFrame</td>
	<td>relative=top</td>
	<td>top</td>
</tr>
<tr>
	<td>waitForText</td>
	<td>//a[@id='_15_structureName']</td>
	<td>Expando Structure Test</td>
</tr>
<tr>
	<td>assertText</td>
	<td>//a[@id='_15_structureName']</td>
	<td>Expando Structure Test</td>
</tr>
<tr>
	<td>clickAt</td>
	<td>//input[@value='Launch Editor']</td>
	<td>Launch Editor</td>
</tr>
<tr>
	<td>waitForVisible</td>
	<td>//iframe[@id='_15_xslContentIFrame']</td>
	<td>Editor</td>
</tr>
<tr>
	<td>selectFrame</td>
	<td>//iframe[@id='_15_xslContentIFrame']</td>
	<td>Editor</td>
</tr>
<tr>
	<td>pause</td>
	<td>5000</td>
	<td></td>
</tr>
<tr>
	<td>type</td>
	<td>//textarea[@id='_15_plainEditorField']</td>
	<td>##<br />## Do some request handling setup.<br />##<br /><br />#set ($companyId = $getterUtil.getLong($request.theme-display.company-id))<br />#set ($locale = $localeUtil.fromLanguageId($request.locale))<br />#set ($dateFormatDateTime = $dateFormats.getDateTime($locale))<br /><br />#set ($renderUrl = $request.render-url)<br />#set ($pns = $request.portlet-namespace)<br />#set ($cmd = $getterUtil.getString($request.parameters.cmd))<br /><br />#set ($cur = $getterUtil.getInteger($request.parameters.cur, 1))<br />#set ($delta = $getterUtil.getInteger($request.parameters.delta, 5))<br /><br />#set ($end = $cur * $delta)<br />#set ($start = $end - $delta)<br /><br /><h1>First Expando Bank</h1><br /><br />##<br />## Define the "name" for our ExpandoTable.<br />##<br /><br />#set ($accountsTableName = "AccountsTable")<br /><br />##<br />## Get/Create the ExpandoTable to hold our data.<br />##<br /><br />#set ($accountsTable = $expandoTableLocalService.getTable($companyId, $accountsTableName, $accountsTableName))<br />#set ($accountsTableId = $accountsTable.getTableId())<br /><br />#if (!$accountsTable)<br />	#set ($accountsTable = $expandoTableLocalService.addTable($companyId, $accountsTableName, $accountsTableName))<br />	#set ($accountsTableId = $accountsTable.getTableId())<br /><br />	#set ($VOID = $expandoColumnLocalService.addColumn($accountsTableId, "firstName", 15)) ## STRING<br />	#set ($VOID = $expandoColumnLocalService.addColumn($accountsTableId, "lastName", 15)) ## STRING<br />	#set ($VOID = $expandoColumnLocalService.addColumn($accountsTableId, "balance", 5)) ## DOUBLE<br />	#set ($VOID = $expandoColumnLocalService.addColumn($accountsTableId, "modifiedDate", 3)) ## DATE<br />#end<br /><br />#set ($accountsTableClassNameId = $accountsTable.getClassNameId())<br />#set ($columns = $expandoColumnLocalService.getColumns($accountsTableId))<br /><br />##<br />## Check to see if a classPK was passed in the request.<br />##<br /><br />#set ($classPK = $getterUtil.getLong($request.parameters.classPK))<br /><br />##<br />## Check if we have received a form submission?<br />##<br /><br />#if ($cmd.equals('add') || $cmd.equals('update'))<br />	##<br />	## Let's get the form values from the request.<br />	##<br /><br />	#set ($firstName = $getterUtil.getString($request.parameters.firstName, ''))<br />	#set ($lastName = $getterUtil.getString($request.parameters.lastName, ''))<br />	#set ($balance = $getterUtil.getDouble($request.parameters.balance, 0.0))<br />	#set ($date = $dateTool.getDate())<br /><br />	##<br />	## Validate the params to see if we should proceed.<br />	##<br /><br />	#if ($balance < 50)<br />		Please fill the form completely in order to create an account. The minimum amount of cash required to create an account is $50.<br />	#elseif (!$firstName.equals('') && !$lastName.equals(''))<br />		##<br />		## Check to see if it's a new Account.<br />		##<br /><br />		#if ($classPK <= 0)<br />			#set ($classPK = $dateTool.getDate().getTime())<br />		#end<br /><br />		#set ($VOID = $expandoValueLocalService.addValues($accountsTableClassNameId, $accountsTableId, $columns, $classPK, {'firstName':$firstName, 'lastName':$lastName, 'balance':"$balance", 'modifiedDate':"${date.getTime()}"}))<br /><br />		##<br />		## Show a response.<br />		##<br /><br />		#if ($cmd.equals('update'))<br />			Thank you, ${firstName}, for updating your account with our bank!<br />		#else<br />			Thank you, ${firstName}, for creating an account with our bank!<br />		#end<br />	#else<br />		Please fill the form completely in order to create an account. Make sure to till both first and last name fields.<br />	#end<br />#elseif ($cmd.equals('delete'))<br />	##<br />	## Delete the specified Row.<br />	##<br /><br />	#if ($classPK > 0)<br />		#set ($VOID = $expandoRowLocalService.deleteRow($accountsTableId, $classPK))<br /><br />		Account deleted!<br /><br />		#set ($classPK = 0)<br />	#end<br />#elseif ($cmd.equals('edit'))<br />	##<br />	## Edit the specified Row.<br />	##<br /><br />	Editting...<br />#end<br /><br /><span style="display: block; border-top: 1px solid #CCC; margin: 5px 0px 5px 0px;"></span><br /><br />#if (!$cmd.equals('edit'))<br />	##<br />	## Now we're into the display logic.<br />	##<br /><br />	<input type="button" value="Create Account" onClick="self.location = '${renderUrl}&${pns}cmd=edit';" /><br /><br />	<br /><br /><br /><br />	<table class="taglib-search-iterator"><br />	<tr class="results-header"><br />		<th class="col-1">Account Number</th><br />		<th class="col-2">First Name</th><br />		<th class="col-3">Last Name</th><br />		<th class="col-4">Balance</th><br />		<th class="col-5">Modified Date</th><br />		<th class="col-6"><!----></th><br />	</tr><br /><br />	##<br />	## Get all the current records in our ExpandoTable. We can paginate by passing a<br />	## "begin" and "end" params.<br />	##<br /><br />	#set ($total = $expandoRowLocalService.getRowsCount($accountsTableId))<br />	#set ($rows = $expandoRowLocalService.getRows($accountsTableId, $start, $end))<br /><br />	#foreach($row in $rows)<br />		#set ($cssClass = 'results-row')<br /><br />		#if ($velocityCount % 2 == 0)<br />			#set ($cssClass = "${cssClass} alt")<br />		#end<br /><br />		#if ($velocityCount == 1)<br />			#set ($cssClass = "${cssClass} first")<br />		#elseif ($velocityCount == $rows.size())<br />			#set ($cssClass = "${cssClass} last")<br />		#end<br /><br />		##<br />		## Get the classPK of this row.<br />		##<br /><br />		#set ($currentClassPK = $row.getClassPK())<br /><br />		#set ($rowValues = $expandoValueLocalService.getRowValues($row.getRowId()))<br /><br />		#set ($values = {})<br /><br />		#foreach ($value in $rowValues)<br />			#foreach ($column in $columns)<br />				#if ($value.columnId == $column.columnId)<br />					#set ($VOID = $values.put($column.name, $value))<br />				#end<br />			#end<br />		#end<br /><br />		#set ($currentFirstName = $values.firstName.string)<br />		#set ($currentLastName = $values.lastName.string)<br />		#set ($currentBalance = $values.balance.double)<br />		#set ($currentModifiedDate = $values.modifiedDate.date)<br /><br />		<tr class="${cssClass}"><br />			<td class="align-left col-1 valign-left">${currentClassPK}</td><br /><br />			<td class="align-left col-2 valign-middle">${currentFirstName}</td><br /><br />			<td class="align-left col-3 valign-middle">${currentLastName}</td><br /><br />			<td class="align-right col-4 valign-middle">${numberTool.currency($currentBalance)}</td><br /><br />			<td class="align-left col-5 valign-middle">${dateFormatDateTime.format($currentModifiedDate)}</td><br /><br />			<td class="align-right col-6 valign-middle"><br />				<a href="${renderUrl}&${pns}cmd=edit&${pns}classPK=${currentClassPK}">Edit</a> |<br />				<a href="${renderUrl}&${pns}cmd=delete&${pns}classPK=${currentClassPK}">Delete</a><br />			</td><br />		</tr><br />	#end<br /><br />	#if ($total <= 0)<br />		<tr><br />			<td colspan="5">No Accounts were found.</td><br />		</tr><br />	#end<br /><br />	</table><br /><br />	<br/><br /><br />	#if ($total > $delta)<br />		<div style="float: right;"><br />			<div><br />				#set ($previous = $cur - 1)<br />				#set ($next = $cur + 1)<br /><br />				#if ($previous > 0)<br />					<a href="${renderUrl}&${pns}cur=${previous}" class="previous">‹‹ #language('previous')</a><br />				#else<br />					<span class="previous">‹‹ #language('previous')</span><br />				#end<br /><br />				#set ($pagesIteratorBegin = 1)<br />				#set ($pagesIteratorEnd = $total / $delta)<br />				#if (($total % $delta) > 0)<br />					#set ($pagesIteratorEnd = $pagesIteratorEnd + 1)<br />				#end<br /><br />				#foreach ($index in [$pagesIteratorBegin..$pagesIteratorEnd])<br />					#if ($index == $cur)<br />						#set ($pageNumber = "<strong>${index}</strong>")<br />					#else<br />						#set ($pageNumber = $index)<br />					#end<br /><br />					<a href="${renderUrl}&${pns}cur=${index}" class="previous">${pageNumber}</a><br />				#end<br /><br />				#if ($next > $cur && $next <= $pagesIteratorEnd)<br />					<a href="${renderUrl}&${pns}cur=${next}" class="next">#language('next') ››</a><br />				#else<br />					<span class="next">#language('next') ››</span><br />				#end<br />			</div><br />		</div><br />	#end<br /><br />	# of Accounts: ${total}<br />#else<br />	##<br />	## Here we have our input form.<br />	##<br /><br />	#if ($classPK > 0)<br />		##<br />		## Get the account specific values<br />		##<br /><br />		#set ($rowValues = $expandoValueLocalService.getRowValues($companyId, $accountsTableName, $accountsTableName, $classPK, -1, -1))<br /><br />		#set ($values = {})<br /><br />		#foreach ($value in $rowValues)<br />			#foreach ($column in $columns)<br />				#if ($value.columnId == $column.columnId)<br />					#set ($VOID = $values.put($column.name, $value))<br />				#end<br />			#end<br />		#end<br /><br />		#set ($currentFirstName = $values.firstName.string)<br />		#set ($currentLastName = $values.lastName.string)<br />		#set ($currentBalance = $values.balance.double)<br />	#end<br /><br />	<form action="$renderUrl" method="post" name="${pns}fm10"><br />	<input type="hidden" name="${pns}classPK" value="$!{classPK}" /><br />	<input type="hidden" name="${pns}cmd" #if ($classPK > 0) value="update" #else value="add" #end/><br /><br />	<table class="lfr-table"><br />	<tr><br />		<td>First Name:</td><br />		<td><br />			<input type="text" name="${pns}firstName" value="$!{currentFirstName}" /><br />		</td><br />	</tr><br />	<tr><br />		<td>Last Name:</td><br />		<td><br />			<input type="text" name="${pns}lastName" value="$!{currentLastName}" /><br />		</td><br />	</tr><br />	<tr><br />		<td>Balance:</td><br />		<td><br />			<input type="text" name="${pns}balance" value="$!{numberTool.format($currentBalance)}" /><br />		</td><br />	</tr><br />	</table><br /><br />	<br /><br /><br />	<input type="submit" value="Save" /><br />	<input type="button" value="Cancel" onclick="self.location = '${renderUrl}'" /><br />	</form><br />#end<br /><br /><br /><br /><br /></td>
</tr>
<tr>
	<td>click</td>
	<td>//input[@value='Update']</td>
	<td>Update</td>
</tr>
<tr>
	<td>selectFrame</td>
	<td>relative=top</td>
	<td>top</td>
</tr>
<tr>
	<td>pause</td>
	<td>5000</td>
	<td></td>
</tr>
<tr>
	<td>clickAtAndWait</td>
	<td>//input[@value='Save']</td>
	<td>Save</td>
</tr>
<tr>
	<td>waitForVisible</td>
	<td>//div[@class='portlet-msg-success']</td>
	<td>Your request completed successfully.</td>
</tr>
<tr>
	<td>assertText</td>
	<td>//div[@class='portlet-msg-success']</td>
	<td>Your request completed successfully.</td>
</tr>
<tr>
	<td>assertText</td>
	<td>//tr[3]/td[3]/a</td>
	<td>Expando Template Test</td>
</tr>
<tr>
	<td>assertText</td>
	<td>//tr[3]/td[4]/a</td>
	<td>This is an expando template test.</td>
</tr>
</tbody></table>
</body>
</html>